{% extends "base.html" %}
{% block title %}Daily Rankings{% endblock %}

{% block content %}
<h1>Rankings for {{ date }}</h1>

<div class="date-selector">
    <button onclick="changeDate(-1)">Previous Day</button>
    <input type="date" id="dateSelect" value="{{ date }}" onchange="loadDate(this.value)">
    <button onclick="changeDate(1)">Next Day</button>
</div>

<div class="rankings-container">
    <table>
        <thead>
            <tr>
                <th>Position</th>
                <th>Name</th>
                <th>Time</th>
                <th>Status</th>
                <th>Points</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in rankings %}
            <tr class="rank-row {% if entry.status == 'in-office' %}in-office{% endif %}">
                <td>{{ loop.index }}</td>
                <td>{{ entry.name }}</td>
                <td>{{ entry.time }}</td>
                <td>{{ entry.status }}</td>
                <td>{{ entry.points }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="timeline-container">
    <h2>Daily Schedule Timeline</h2>
    <div class="timeline-scale">
        <span>7:00</span>
        <span>8:00</span>
        <span>9:00</span>
        <span>10:00</span>
        <span>11:00</span>
        <span>12:00</span>
        <span>13:00</span>
        <span>14:00</span>
        <span>15:00</span>
        <span>16:00</span>
        <span>17:00</span>
        <span>18:00</span>
    </div>
    <div class="timeline-grid">
        {% for entry in rankings %}
        <div class="timeline-row">
            <span class="timeline-name">{{ entry.name }}</span>
            <div class="timeline-bar-container">
                <div class="timeline-bar" 
                     style="left: {{ ((entry.time_obj.hour * 60 + entry.time_obj.minute - 420) / 660) * 100 }}%; 
                            width: {{ (entry.shift_length / 660) * 100 }}%"
                     title="{{ entry.name }}: {{ entry.time }} - {{ entry.end_time }}">
                    <span class="timeline-time">{{ entry.time }}</span>
                    <span class="timeline-end-time">{{ entry.end_time }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function changeDate(delta) {
    const dateInput = document.getElementById('dateSelect');
    const currentDate = new Date(dateInput.value);
    currentDate.setDate(currentDate.getDate() + delta);
    dateInput.value = currentDate.toISOString().split('T')[0];
    loadDate(dateInput.value);
}

function loadDate(date) {
    window.location.href = `/rankings/day/${date}`;
}
</script>

<style>
.date-selector {
    margin: 20px 0;
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
}

.rankings-container {
    margin-top: 20px;
}

.rank-row.in-office {
    font-weight: bold;
}

.timeline-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-top: 30px;
}

.timeline-scale {
    display: grid;
    grid-template-columns: repeat(11, 1fr);  /* Changed from 12 to 11 columns */
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
}

.timeline-scale span {
    font-size: 0.8em;
    color: #666;
    text-align: center;
}

.timeline-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.timeline-row {
    display: flex;
    align-items: center;
    height: 40px;
}

.timeline-name {
    width: 120px;
    font-size: 0.9em;
    padding-right: 10px;
}

.timeline-bar-container {
    position: relative;
    flex-grow: 1;
    height: 25px;
    background: #f5f5f5;
    border-radius: 4px;
    background-image: linear-gradient(90deg, #eee 1px, transparent 1px);
    background-size: calc(100% / 11) 100%;  /* Changed from 12 to 11 divisions */
}

.timeline-bar {
    position: absolute;
    height: 100%;
    background: var(--accent-color);
    border-radius: 4px;
    transition: all 0.3s ease;
}

.timeline-bar:hover {
    transform: scaleY(1.1);
    z-index: 1;
}

.timeline-time, .timeline-end-time {
    position: absolute;
    font-size: 0.8em;
    color: white;
    top: 50%;
    transform: translateY(-50%);
    padding: 0 5px;
    white-space: nowrap;
}

.timeline-time {
    left: 5px;
}

.timeline-end-time {
    right: 5px;
}
</style>
{% endblock %}
